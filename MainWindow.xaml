<Window x:Class="SaveCodeClassfication.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SaveCodeClassfication"
        xmlns:views="clr-namespace:SaveCodeClassfication.Views"
        mc:Ignorable="d"
        Title="Masin 세이브코드 분류" Height="800" Width="1600"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- 메인 탭 컨트롤 -->
        <TabControl x:Name="MainTabControl" Grid.Row="0" Margin="10">
            <!-- 세이브코드 분류 탭 -->
            <TabItem Header="📁 세이브코드 분류" Padding="10,5">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="250"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="400"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="350"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Left Panel: Folder Selection -->
                    <StackPanel Grid.Column="0">
                        
                        <!-- Header -->
                        <Border Background="#f0f0f0" CornerRadius="5" Padding="15" Margin="0,0,0,20">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="📁" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <TextBlock Text="Masin 세이브코드 분류" FontSize="16" FontWeight="Bold" 
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Folder Selection Section -->
                        <GroupBox Header="폴더 설정" Margin="0,0,0,20" Padding="15">
                            <StackPanel>
                                <DockPanel Margin="0,0,0,10">
                                    <Button Name="BtnChangeFolder" Content="폴더 변경" 
                                              Background="#FF9800" Foreground="White"
                                              Click="BtnSelectFolder_Click" 
                                              Height="30" MinWidth="80" DockPanel.Dock="Right"
                                              Padding="10,5" FontSize="12" Margin="5,0,0,0"/>
                                    <Button Name="BtnReloadFolder" Content="새로고침" 
                                              Background="#4CAF50" Foreground="White"
                                              Click="BtnReloadFolder_Click" 
                                              Height="30" MinWidth="80" DockPanel.Dock="Right"
                                              Padding="10,5" FontSize="12"/>
                                </DockPanel>
                                
                                <TextBox Name="TxtFolderPath" 
                                        Text="저장된 폴더를 자동으로 로드합니다..."
                                        IsReadOnly="True"
                                        Foreground="Gray"
                                        Padding="8"
                                        VerticalContentAlignment="Center"
                                        TextWrapping="Wrap"
                                        MinHeight="60"/>
                                
                                <StackPanel Orientation="Vertical" Margin="0,10,0,0">
                                    <Border Name="TagFolderInfo" Background="#e3f2fd" CornerRadius="3" 
                                           Padding="8,4" Margin="0,0,0,5">
                                        <TextBlock Text="앱 시작 시 자동으로 폴더를 로드합니다" FontSize="12"/>
                                    </Border>
                                    <Border Name="TagFileCount" Background="#e8f5e8" CornerRadius="3" 
                                           Padding="8,4" Visibility="Collapsed">
                                        <TextBlock Name="TagFileCountText" FontSize="12"/>
                                    </Border>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- Analysis Button -->
                        <Button Name="BtnAnalyzeFiles" Content="파일 분석" 
                                Background="#4CAF50" Foreground="White"
                                Click="BtnAnalyzeFiles_Click" 
                                Height="40" Padding="15,8"
                                FontSize="14" Margin="0,0,0,10"
                                IsEnabled="False"/>
                        
                        <!-- Database Management -->
                        <GroupBox Header="데이터베이스 관리" Margin="0,0,0,20" Padding="10">
                            <StackPanel>
                                <Button Name="BtnSaveToDatabase" Content="💾 DB 저장" 
                                        Background="#2196F3" Foreground="White"
                                        Click="BtnSaveToDatabase_Click" 
                                        Height="35" Padding="10,5"
                                        FontSize="12" Margin="0,0,0,5"
                                        IsEnabled="False"
                                        ToolTip="현재 분석된 결과를 데이터베이스에 저장"/>
                                <TextBlock Name="TxtCacheInfo" Text="데이터베이스 상태: 연결 중..." 
                                          FontSize="10" Foreground="Gray" 
                                          TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>
                        
                    </StackPanel>
                    
                    <!-- Splitter 1 -->
                    <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" 
                                 Background="#ddd" IsEnabled="False"/>
                    
                    <!-- Middle Panel: Character List -->
                    <GroupBox Grid.Column="2" Header="캐릭터 목록" Padding="15">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <DockPanel Grid.Row="0" Margin="0,0,0,10">
                                <Button Name="BtnClearCharacters" Content="조회" 
                                          Background="#ff9800" Foreground="White"
                                          Click="BtnClearCharacters_Click" 
                                          MinWidth="70" Height="30" DockPanel.Dock="Right"
                                          Padding="10,5" FontSize="12"/>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="캐릭터별 세이브 코드" FontWeight="Bold" FontSize="12"/>
                                    <TextBlock Name="TxtCharacterCount" Text="분석된 캐릭터: 0개" 
                                              FontSize="10" Foreground="Gray"/>
                                </StackPanel>
                            </DockPanel>
                            
                            <!-- Character Search Section -->
                            <StackPanel Grid.Row="1" Orientation="Vertical" Margin="0,0,0,10">
                                <DockPanel Margin="0,0,0,5">
                                    <Button Name="BtnClearSearch" Content="✖" 
                                            Background="#e0e0e0" Foreground="#666"
                                            Click="BtnClearSearch_Click"
                                            Width="25" Height="25" DockPanel.Dock="Right"
                                            Margin="5,0,0,0" ToolTip="검색어 지우기"/>
                                    <TextBox Name="TxtCharacterSearch" 
                                            Padding="8,6"
                                            FontSize="12"
                                            Text=""
                                            TextChanged="TxtCharacterSearch_TextChanged"
                                            BorderBrush="#ccc"
                                            BorderThickness="1"
                                            Background="White"/>
                                </DockPanel>
                                <TextBlock Text="🔍 캐릭터명으로 검색" FontSize="9" 
                                          Foreground="#888" Margin="2,0,0,5"/>
                                <StackPanel Name="SearchResultPanel" Orientation="Horizontal" 
                                           Visibility="Collapsed" Margin="0,0,0,5">
                                    <TextBlock Name="TxtSearchResult" FontSize="10" 
                                              Foreground="#2196f3" FontWeight="Bold"/>
                                    <TextBlock Name="TxtSearchCount" FontSize="10" 
                                              Foreground="#888" Margin="5,0,0,0"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <ListBox Name="LstCharacters" Grid.Row="2"
                                    SelectionChanged="LstCharacters_SelectionChanged">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Vertical" Margin="5">
                                            <TextBlock Text="{Binding CharacterName}" FontWeight="Bold" FontSize="13"
                                                      TextWrapping="Wrap"/>
                                            <TextBlock Text="{Binding SaveCodeCount}" FontSize="10" Foreground="Gray"
                                                      TextWrapping="Wrap"/>
                                            <TextBlock Text="{Binding LastModified}" FontSize="9" Foreground="DarkGray"
                                                      TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </GroupBox>
                    
                    <!-- Splitter 2 -->
                    <GridSplitter Grid.Column="3" Width="5" HorizontalAlignment="Stretch" 
                                 Background="#ddd" Cursor="SizeWE"/>
                    
                    <!-- Save Code List Panel -->
                    <GroupBox Grid.Column="4" Header="세이브 코드 목록" Padding="10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Character Info -->
                            <Border Grid.Row="0" Background="#f8f9fa" CornerRadius="5" 
                                   Padding="10" Margin="0,0,0,10">
                                <StackPanel Orientation="Vertical">
                                    <DockPanel>
                                        <Button Name="BtnCopyCode" Content="코드 복사" 
                                                  Background="#2196f3" Foreground="White"
                                                  Click="BtnCopyCode_Click"
                                                  MinWidth="70" Height="25" DockPanel.Dock="Right"
                                                  Padding="8,3" FontSize="10"/>
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock Name="TxtSelectedCharacter" Text="캐릭터를 선택해주세요" 
                                                      FontWeight="Bold" FontSize="14" TextWrapping="Wrap"/>
                                            <TextBlock Name="TxtSelectedInfo" Text="캐릭터를 선택하면 세이브 코드가 표시됩니다" 
                                                      FontSize="10" Foreground="Gray" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </DockPanel>
                                </StackPanel>
                            </Border>
                            
                            <!-- 간단한 정렬 컨트롤 영역 -->
                            <Border Grid.Row="1" Background="#f0f8ff" CornerRadius="5" 
                                   Padding="8" Margin="0,0,0,10">
                                <DockPanel>
                                    <Button Name="BtnToggleDateSort" Content="⇅ 정렬" 
                                            Background="#4CAF50" Foreground="White"
                                            Click="ToggleDateSort_Click"
                                            Width="60" Height="25" DockPanel.Dock="Right"
                                            Padding="5" FontSize="10" Margin="5,0,0,0"
                                            ToolTip="최신순 ⇄ 오래된순 토글"/>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="정렬:" FontSize="10" FontWeight="Bold" 
                                                  Foreground="DarkBlue" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                        <TextBlock Name="TxtCurrentDateSort" Text="최신순" 
                                                  FontSize="10" FontWeight="Bold" Foreground="DarkBlue" 
                                                  VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DockPanel>
                            </Border>
                            
                            <!-- 세이브 코드 리스트 -->
                            <ListBox Name="LstSaveCodes" Grid.Row="2"
                                    SelectionChanged="LstSaveCodes_SelectionChanged">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#f9f9f9" CornerRadius="3" Padding="6" Margin="2">
                                            <StackPanel Orientation="Vertical">
                                                <DockPanel Margin="0,0,0,3">
                                                    <TextBlock Text="{Binding FileDate, StringFormat='MM-dd HH:mm'}" 
                                                              FontSize="9" Foreground="Gray" DockPanel.Dock="Right"/>
                                                    <TextBlock Text="{Binding FileName}" FontWeight="Bold" FontSize="10" 
                                                              TextWrapping="Wrap"/>
                                                </DockPanel>
                                                
                                                <!-- 기본 정보 -->
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                                                    <TextBlock Text="레벨:" FontSize="9" Foreground="DarkGreen" Margin="0,0,2,0"/>
                                                    <TextBlock Text="{Binding Level}" FontSize="9" Foreground="DarkGreen" Margin="0,0,8,0"/>
                                                    <TextBlock Text="무력:" FontSize="9" Foreground="Red" Margin="0,0,2,0"/>
                                                    <TextBlock Text="{Binding PhysicalPower}" FontSize="9" Foreground="Red"/>
                                                </StackPanel>
                                                
                                                <!-- 아이템 정보 (요약) -->
                                                <Border Background="#fff8dc" CornerRadius="2" Padding="4,2" Margin="0,2,0,0">
                                                    <StackPanel Orientation="Vertical">
                                                        <TextBlock Text="🎒 장착 아이템:" FontSize="8" FontWeight="Bold" 
                                                                  Foreground="DarkMagenta" Margin="0,0,0,1"/>
                                                        <ItemsControl ItemsSource="{Binding Items}" MaxHeight="40">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <TextBlock Text="{Binding}" FontSize="8" 
                                                                              Foreground="DarkMagenta" TextWrapping="Wrap" 
                                                                              Margin="0,0,0,1" TextTrimming="CharacterEllipsis"/>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                        <TextBlock Text="(상세보기에서 전체 정보 확인)" FontSize="7" 
                                                                  Foreground="Gray" FontStyle="Italic"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </GroupBox>
                    
                    <!-- Splitter 3 -->
                    <GridSplitter Grid.Column="5" Width="5" HorizontalAlignment="Stretch" 
                                 Background="#ddd" Cursor="SizeWE"/>
                    
                    <!-- Selected Save Code Detail Panel -->
                    <GroupBox Grid.Column="6" Header="선택된 세이브 코드 상세 정보" Padding="10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- 상세 정보 버튼들 -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                <Button Name="BtnCopyFullInfo" Content="📄 전체 정보 복사" 
                                        Background="#607D8B" Foreground="White"
                                        Click="BtnCopyFullInfo_Click"
                                        Height="25" Padding="8,3" FontSize="10"
                                        ToolTip="모든 상세 정보를 클립보드에 복사"/>
                            </StackPanel>
                            
                            <!-- 상세 정보 표시 영역 -->
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" 
                                         HorizontalScrollBarVisibility="Auto">
                                <TextBox Name="TxtSelectedCode" 
                                        FontFamily="Consolas"
                                        FontSize="12"
                                        IsReadOnly="True"
                                        Text="세이브 코드를 선택하면 여기에 상세 정보가 표시됩니다..."
                                        Foreground="Gray"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        TextWrapping="Wrap"
                                        AcceptsReturn="True"/>
                            </ScrollViewer>
                        </Grid>
                    </GroupBox>
                    
                </Grid>
            </TabItem>
            
            <!-- 토큰 생성 탭 -->
            <TabItem Header="🔑 토큰 생성" Padding="10,5">
                <views:TokenGeneratorView x:Name="TokenGeneratorControl"/>
            </TabItem>
        </TabControl>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="1" Background="#f8f9fa">
            <StatusBarItem Content="준비됨"/>
            <StatusBarItem Name="StatusBarProgress" Visibility="Collapsed">
                <ProgressBar Width="120" Height="16" IsIndeterminate="True"/>
            </StatusBarItem>
            <StatusBarItem Name="StatusBarMessage" Content="폴더를 선택하고 파일을 분석해주세요"/>
        </StatusBar>
        
    </Grid>
</Window>